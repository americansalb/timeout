<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Spanish Speaking Test</title>
</head>
<body>

  <!-- 1. Embed the widget -->
  <elevenlabs-convai agent-id="agent_01jz3qjsftfrt8jhzg64bmfdrz"></elevenlabs-convai>

  <!-- 2. Register the PAUSE tool and metadata BEFORE the widget connects -->
  <script>
    // When the widget establishes a connection, inject tools and metadata
    window.addEventListener('elevenlabs-convai:connect', (event) => {
      const cfg = event.detail.config;

      // 2‑a. PAUSE tool available throughout the conversation
      cfg.clientTools = {
        PAUSE_5_Second: async () => {
          try {
            await fetch('https://timeout-ri84.onrender.com/pause', { method: 'POST' });
            console.log('PAUSE_5_Second invoked');
          } catch (err) {
            console.error('Pause endpoint failed:', err);
          }
          return {}; // must return an object (can be empty)
        }
      };

      // 2‑b. Pass metadata from URL parameters
      const qs        = new URLSearchParams(window.location.search);
      cfg.conversationMetadata = {
        email:      qs.get('email')      || '',
        first_name: qs.get('first_name') || '',
        last_name:  qs.get('last_name')  || ''
      };
    });
  </script>

  <!-- 3. Load the widget SDK last to honour the listener above -->
  <script src="https://unpkg.com/@elevenlabs/convai-widget-embed" defer></script>

</body>
</html>
